var global_parentBox,marker=!0,itemBoxFull=document.querySelectorAll(".item_box");function clatch(){marker=!1}function addEvent(e,t,o){return e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent("on"+t,function(){o.call(e)}),!1}function showRect(e){return{top:e.getBoundingClientRect().top+pageYOffset+40}}function calc_total_sum(){for(var e=0,t=0,o=0,r=0,n=document.querySelectorAll(".item_box"),c=0;c<n.length;c++)t=Number(n[c].querySelector(".goods_price").innerHTML)*Number(n[c].querySelector(".goods_cnt").innerHTML),e+=n[c].querySelector(".goods_sum").innerHTML=t;r=e+(o=.18*e),document.querySelector(".tmp_total_sum").innerHTML=e.toLocaleString("ru"),document.querySelector(".total_nds_sum").innerHTML=o.toLocaleString("ru"),document.querySelector(".total_sum").innerHTML=r.toLocaleString("ru")}function changeSelect(){for(var e=0,t=document.querySelectorAll(".item_box"),o=0;o<t.length;o++)t[o].querySelector(".select_item").checked&&(e+=1);document.querySelector(".select_cnt").innerHTML="<b>"+e+"</b>"}function incId(){for(var e=document.querySelectorAll(".item_box"),t=0;t<e.length;t++)e[t].querySelector(".cnt_num").innerHTML=t+1}$(document).mouseup(function(e){var t=$(".popup_edit");e.target==t[0]||t.has(e.target).length||t.hide()}),$(document).ready(function(){for(var e=0;e<itemBoxFull.length;e++)addEvent(itemBoxFull[e].querySelector(".select_item"),"change",changeSelect);calc_total_sum(),$(".goods_cnt").click(function(){var e,t,o=showRect(this),r=document.querySelector(".popup_edit"),n=0;n=(e=(global_parentBox=this.parentNode).querySelector(".goods_price").innerHTML)*(t=global_parentBox.querySelector(".goods_cnt").innerHTML),console.log("price = "+e+"\n cnt = "+t),r.style.top=parseInt(o.top)+"px",r.style.right="20px",r.querySelector(".popup_price").innerHTML=e,r.querySelector(".popup_cnt").value=t,r.querySelector(".popup_sum").innerHTML=n.toLocaleString("ru"),$(".popup_edit").toggle()}),$(".popup_munus_item").on("click",function(){var e=this.parentNode,t=Number(e.querySelector(".popup_cnt").value),o=Number(e.querySelector(".popup_price").innerHTML);0<t&&(t-=1),sum=t*o,e.querySelector(".popup_cnt").value=t,e.querySelector(".popup_sum").innerHTML=sum,console.log(t)}),$(".popup_plus_item").on("click",function(){var e,t=this.parentNode,o=Number(t.querySelector(".popup_cnt").value);e=(o+=1)*Number(t.querySelector(".popup_price").innerHTML),t.querySelector(".popup_cnt").value=o,t.querySelector(".popup_sum").innerHTML=e,console.log(o)}),$(".popup_save").on("click",function(){this.closest(".popup_cnt_control");var e=Number(document.querySelector(".popup_cnt").value);global_parentBox.querySelector(".goods_cnt").innerHTML=e,$(".popup_edit").toggle(),calc_total_sum()}),$(".popup_cansel").on("click",function(){$(".popup_edit").toggle()}),$(".dlt_btn").on("click",function(){for(var e=document.querySelector("table"),t=document.querySelectorAll(".item_box"),o=0;o<t.length;o++){var r=t[o].querySelector(".select_item");if(1==r.checked){var n=r.parentNode.parentNode;e.deleteRow(n.rowIndex)}}document.querySelector(".select_cnt").innerHTML="0",incId(),calc_total_sum()})});